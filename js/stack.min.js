// THROTTLE-DEBOUNCE
// http://benalman.com/projects/jquery-throttle-debounce-plugin/
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);

// SORTELEMENTS
// http://james.padolsey.com/javascript/sorting-elements-with-jquery/
jQuery.fn.sortElements=function(){var e=[].sort;return function(f,a){var a=a||function(){return this},g=this.map(function(){var b=a.call(this),c=b.parentNode,d=c.insertBefore(document.createTextNode(""),b.nextSibling);return function(){if(c===this)throw Error("You can't sort elements if any one is a descendant of another.");c.insertBefore(this,d);c.removeChild(d)}});return e.call(this,f).each(function(b){g[b].call(a.call(this))})}}();

// JQUERY.TABBY.MIN.JS
// http://teddevito.com/demos/textarea.html
(function(h){h.fn.tabby=function(m){var p=h.extend({},h.fn.tabby.defaults,m),l=h.fn.tabby.pressed;return this.each(function(){$this=h(this);var b=h.meta?h.extend({},p,$this.data()):p;$this.bind("keydown",function(a){var m=h.fn.tabby.catch_kc(a);if(16==m)l.shft=!0;if(17==m)l.ctrl=!0,setTimeout("$.fn.tabby.pressed.ctrl = false;",1E3);if(18==m)l.alt=!0,setTimeout("$.fn.tabby.pressed.alt = false;",1E3);if(9==m&&!l.ctrl&&!l.alt){l.last=m;setTimeout("$.fn.tabby.pressed.last = null;",0);var a=h(a.target).get(0),
i=l.shft,m=a.scrollTop;if(a.setSelectionRange){var d=a.selectionStart,j=a.selectionEnd;if(d==j)if(i)if("\t"==a.value.substring(d-b.tabString.length,d))a.value=a.value.substring(0,d-b.tabString.length)+a.value.substring(d),a.focus(),a.setSelectionRange(d-b.tabString.length,d-b.tabString.length);else{if("\t"==a.value.substring(d,d+b.tabString.length))a.value=a.value.substring(0,d)+a.value.substring(d+b.tabString.length),a.focus(),a.setSelectionRange(d,d)}else a.value=a.value.substring(0,d)+b.tabString+
a.value.substring(d),a.focus(),a.setSelectionRange(d+b.tabString.length,d+b.tabString.length);else{var e=a.value.split("\n"),f=[],g=0,k=0,c;for(c in e)k=g+e[c].length,f.push({start:g,end:k,selected:g<=d&&k>d||k>=j&&g<j||g>d&&k<j}),g=k+1;e=0;for(c in f)if(f[c].selected)if(g=f[c].start+e,i&&b.tabString==a.value.substring(g,g+b.tabString.length))a.value=a.value.substring(0,g)+a.value.substring(g+b.tabString.length),e-=b.tabString.length;else if(!i)a.value=a.value.substring(0,g)+b.tabString+a.value.substring(g),
e+=b.tabString.length;a.focus();a.setSelectionRange(d+(e>0?b.tabString.length:e<0?-b.tabString.length:0),j+e)}}else if(document.selection&&(c=document.selection.createRange(),a==c.parentElement()))if(""==c.text){if(i){i=c.getBookmark();c.moveStart("character",-b.tabString.length);if(b.tabString==c.text)c.text="";else if(c.moveToBookmark(i),c.moveEnd("character",b.tabString.length),b.tabString==c.text)c.text="";c.collapse(!0)}else c.text=b.tabString,c.collapse(!1);c.select()}else{j=c.text;d=j.length;
f=j.split("\r\n");j=document.body.createTextRange();j.moveToElementText(a);j.setEndPoint("EndToStart",c);g=j.text;e=g.split("\r\n");g=g.length;k=document.body.createTextRange();k.moveToElementText(a);k.setEndPoint("StartToEnd",c);var k=k.text,o=document.body.createTextRange();o.moveToElementText(a);o.setEndPoint("StartToEnd",j);var n=o.text,o=h(a).html();h("#r3").text(g+" + "+d+" + "+k.length+" = "+o.length);g+n.length<o.length?(e.push(""),g+=2,i&&b.tabString==f[0].substring(0,b.tabString.length)?
f[0]=f[0].substring(b.tabString.length):i||(f[0]=b.tabString+f[0])):i&&b.tabString==e[e.length-1].substring(0,b.tabString.length)?e[e.length-1]=e[e.length-1].substring(b.tabString.length):i||(e[e.length-1]=b.tabString+e[e.length-1]);for(n=1;n<f.length;n++)i&&b.tabString==f[n].substring(0,b.tabString.length)?f[n]=f[n].substring(b.tabString.length):i||(f[n]=b.tabString+f[n]);1==e.length&&0==g&&(i&&b.tabString==f[0].substring(0,b.tabString.length)?f[0]=f[0].substring(b.tabString.length):i||(f[0]=b.tabString+
f[0]));g+d+k.length<o.length&&f.push("");j.text=e.join("\r\n");c.text=f.join("\r\n");i=document.body.createTextRange();i.moveToElementText(a);0<g?i.setEndPoint("StartToEnd",j):i.setEndPoint("StartToStart",j);i.setEndPoint("EndToEnd",c);i.select()}a.scrollTop=m;return!1}}).bind("keyup",function(a){if(16==h.fn.tabby.catch_kc(a))l.shft=!1}).bind("blur",function(a){9==l.last&&h(a.target).one("focus",function(){l.last=null}).get(0).focus()})})};h.fn.tabby.catch_kc=function(h){return h.keyCode?h.keyCode:
h.charCode?h.charCode:h.which};h.fn.tabby.pressed={shft:!1,ctrl:!1,alt:!1,last:null};h.fn.tabby.defaults={tabString:String.fromCharCode(9)}})(jQuery);

// TAG-IT
// http://aehlke.github.com/tag-it/
(function(b){b.widget("ui.tagit",{options:{itemName:"item",fieldName:"tags",availableTags:[],tagSource:null,removeConfirmation:!1,caseSensitive:!0,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,tabIndex:null,onTagAdded:null,onTagRemoved:null,onTagClicked:null},_create:function(){var a=this;this.element.is("input")?(this.tagList=b("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.css("display","none")):
this.tagList=this.element.find("ul, ol").andSelf().last();this._tagInput=b('<input type="text" placeholder="add tag">').addClass("ui-widget-content");this.options.tabIndex&&this._tagInput.attr("tabindex",this.options.tabIndex);this.options.tagSource=this.options.tagSource||function(e,c){var d=e.term.toLowerCase(),g=b.grep(a.options.availableTags,function(a){return a.toLowerCase().indexOf(d)===0});c(a._subtractArray(g,a.assignedTags()))};this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(b('<li class="tagit-new"></li>').append(this._tagInput)).click(function(e){var c=
b(e.target);c.hasClass("tagit-label")?a._trigger("onTagClicked",e,c.closest(".tagit-choice")):a._tagInput.focus()});this.tagList.children("li").each(function(){b(this).hasClass("tagit-new")||(a.createTag(b(this).html(),b(this).attr("class")),b(this).remove())});if(this.options.singleField)if(this.options.singleFieldNode){var c=b(this.options.singleFieldNode),d=c.val().split(this.options.singleFieldDelimiter);c.val("");b.each(d,function(b,c){a.createTag(c)})}else this.options.singleFieldNode=this.tagList.after('<input type="hidden" style="display:none;" value="" name="'+
this.options.fieldName+'">');this._tagInput.keydown(function(c){if(c.which==b.ui.keyCode.BACKSPACE&&a._tagInput.val()===""){var d=a._lastTag();!a.options.removeConfirmation||d.hasClass("remove")?a.removeTag(d):a.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else a.options.removeConfirmation&&a._lastTag().removeClass("remove ui-state-highlight");if(c.which==b.ui.keyCode.COMMA||c.which==b.ui.keyCode.ENTER||c.which==b.ui.keyCode.TAB&&a._tagInput.val()!==""||c.which==b.ui.keyCode.SPACE&&
a.options.allowSpaces!==!0&&(b.trim(a._tagInput.val()).replace(/^s*/,"").charAt(0)!='"'||b.trim(a._tagInput.val()).charAt(0)=='"'&&b.trim(a._tagInput.val()).charAt(b.trim(a._tagInput.val()).length-1)=='"'&&b.trim(a._tagInput.val()).length-1!==0))c.preventDefault(),a.createTag(a._cleanedInput()),a._tagInput.autocomplete("close")}).blur(function(){a.createTag(a._cleanedInput())});(this.options.availableTags||this.options.tagSource)&&this._tagInput.autocomplete({source:this.options.availableTags,select:function(b,
c){a._tagInput.val()===""&&a.removeTag(a._lastTag(),!1);a.createTag(c.item.value);return!1},position:{my:"left bottom",at:"left top",offset:"3 -5"}})},_cleanedInput:function(){return b.trim(this._tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.children(".tagit-choice:last")},assignedTags:function(){var a=this,c=[];this.options.singleField?(c=b(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),c[0]===""&&(c=[])):this.tagList.children(".tagit-choice").each(function(){c.push(a.tagLabel(this))});
return c},_updateSingleTagsField:function(a){b(this.options.singleFieldNode).val(a.join(this.options.singleFieldDelimiter))},_subtractArray:function(a,c){for(var d=[],e=0;e<a.length;e++)b.inArray(a[e],c)==-1&&d.push(a[e]);return d},tagLabel:function(a){return this.options.singleField?b(a).children(".tagit-label").text():b(a).children("input").val()},_isNew:function(a){var b=this,d=!0;this.tagList.children(".tagit-choice").each(function(){if(b._formatStr(a)==b._formatStr(b.tagLabel(this)))return d=
!1});return d},_formatStr:function(a){if(this.options.caseSensitive)return a;return b.trim(a.toLowerCase())},createTag:function(a,c){that=this;a=b.trim(a);if(!this._isNew(a)||a==="")return!1;var d=b(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(a),e=b("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(d),f=b("<span></span>").addClass("ui-icon ui-icon-close"),f=b('<a><span class="text-icon">\u00d7</span></a>').addClass("close").append(f).click(function(){that.removeTag(e)});
e.append(f);this.options.singleField?(d=this.assignedTags(),d.push(a),this._updateSingleTagsField(d)):(d=d.html(),e.append('<input type="hidden" style="display:none;" value="'+d+'" name="'+this.options.itemName+"["+this.options.fieldName+'][]">'));this._trigger("onTagAdded",null,e);this._tagInput.val("");this._tagInput.parent().before(e)},removeTag:function(a,c){typeof c==="undefined"&&(c=!0);a=b(a);this._trigger("onTagRemoved",null,a);if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(a),
d=b.grep(d,function(a){return a!=e});this._updateSingleTagsField(d)}c?a.fadeOut("fast").hide("blind",{direction:"horizontal"},"fast",function(){a.remove()}).dequeue():a.remove()},removeAll:function(){var a=this;this.tagList.children(".tagit-choice").each(function(b,d){a.removeTag(d,!1)})}})})(jQuery);

// TIMEAGO
// http://timeago.yarp.com/
(function(d){function i(){var a;a=d(this);if(!a.data("timeago")){a.data("timeago",{datetime:e.datetime(a)});var b=d.trim(a.text());b.length>0&&a.attr("title",b)}a=a.data("timeago");isNaN(a.datetime)||d(this).text(f(a.datetime));return this}function f(a){return e.inWords((new Date).getTime()-a.getTime())}d.timeago=function(a){return a instanceof Date?f(a):typeof a==="string"?f(d.timeago.parse(a)):f(d.timeago.datetime(a))};var e=d.timeago;d.extend(d.timeago,{settings:{refreshMillis:6E4,allowFuture:!1,
strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(a){function b(b,e){return(d.isFunction(b)?b(e,a):b).replace(/%d/i,c.numbers&&c.numbers[e]||e)}var c=this.settings.strings,e=c.prefixAgo,f=c.suffixAgo;if(this.settings.allowFuture){if(a<
0)e=c.prefixFromNow,f=c.suffixFromNow;a=Math.abs(a)}var g=a/1E3,j=g/60,k=j/60,h=k/24,i=h/365,g=g<45&&b(c.seconds,Math.round(g))||g<90&&b(c.minute,1)||j<45&&b(c.minutes,Math.round(j))||j<90&&b(c.hour,1)||k<24&&b(c.hours,Math.round(k))||k<48&&b(c.day,1)||h<30&&b(c.days,Math.floor(h))||h<60&&b(c.month,1)||h<365&&b(c.months,Math.floor(h/30))||i<2&&b(c.year,1)||b(c.years,Math.floor(i));return d.trim([e,g,f].join(" "))},parse:function(a){a=d.trim(a);a=a.replace(/\.\d\d\d+/,"");a=a.replace(/-/,"/").replace(/-/,
"/");a=a.replace(/T/," ").replace(/Z/," UTC");a=a.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(a)},datetime:function(a){a=d(a).get(0).tagName.toLowerCase()==="time"?d(a).attr("datetime"):d(a).attr("title");return e.parse(a)}});d.fn.timeago=function(){var a=this;a.each(i);var b=e.settings;b.refreshMillis>0&&setInterval(function(){a.each(i)},b.refreshMillis);return a};document.createElement("abbr");document.createElement("time")})(jQuery);

// JQHOTKEYS (Keyboard shortcuts)
// https://github.com/jeresig/jquery.hotkeys
(function(d){function h(g){if(typeof g.data==="string"){var h=g.handler,i=g.data.toLowerCase().split(" ");g.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||a.target.type==="text"))){var b=a.type!=="keypress"&&d.hotkeys.specialKeys[a.which],e=String.fromCharCode(a.which).toLowerCase(),c="",f={};a.altKey&&b!=="alt"&&(c+="alt+");a.ctrlKey&&b!=="ctrl"&&(c+="ctrl+");a.metaKey&&!a.ctrlKey&&b!=="meta"&&(c+="meta+");a.shiftKey&&b!=="shift"&&(c+="shift+");b?f[c+b]=!0:
(f[c+e]=!0,f[c+d.hotkeys.shiftNums[e]]=!0,c==="shift+"&&(f[d.hotkeys.shiftNums[e]]=!0));b=0;for(e=i.length;b<e;b++)if(f[i[b]])return h.apply(this,arguments)}}}}d.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",
109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};d.each(["keydown","keyup","keypress"],function(){d.event.special[this]={add:h}})})(jQuery);

// DIFF_MATCH_PATCH
// http://code.google.com/p/google-diff-match-patch/
(function(){function i(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=0.5;this.Match_Distance=1E3;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=32}function w(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0}i.prototype.diff_main=function(a,b,c,d){typeof d=="undefined"&&(d=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+this.Diff_Timeout*1E3);if(a==null||b==null)throw Error("Null input. (diff_main)");if(a==b)return a?[[0,a]]:
[];typeof c=="undefined"&&(c=!0);var e=c,f=this.diff_commonPrefix(a,b),c=a.substring(0,f),a=a.substring(f),b=b.substring(f),f=this.diff_commonSuffix(a,b),g=a.substring(a.length-f),a=a.substring(0,a.length-f),b=b.substring(0,b.length-f),a=this.diff_compute_(a,b,e,d);c&&a.unshift([0,c]);g&&a.push([0,g]);this.diff_cleanupMerge(a);return a};i.prototype.diff_compute_=function(a,b,c,d){if(!a)return[[1,b]];if(!b)return[[-1,a]];var e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=e.indexOf(f);return g!=
-1?(c=[[1,e.substring(0,g)],[0,f],[1,e.substring(g+f.length)]],a.length>b.length&&(c[0][0]=c[2][0]=-1),c):f.length==1?[[-1,a],[1,b]]:(e=this.diff_halfMatch_(a,b))?(f=e[0],a=e[1],g=e[2],b=e[3],e=e[4],f=this.diff_main(f,g,c,d),c=this.diff_main(a,b,c,d),f.concat([[0,e]],c)):c&&a.length>100&&b.length>100?this.diff_lineMode_(a,b,d):this.diff_bisect_(a,b,d)};i.prototype.diff_lineMode_=function(a,b,c){var d=this.diff_linesToChars_(a,b),a=d[0],b=d[1],d=d[2],a=this.diff_bisect_(a,b,c);this.diff_charsToLines_(a,
d);this.diff_cleanupSemantic(a);a.push([0,""]);for(var e=b=0,f=0,g=d="";b<a.length;){switch(a[b][0]){case 1:f++;g+=a[b][1];break;case -1:e++;d+=a[b][1];break;case 0:if(e>=1&&f>=1){d=this.diff_main(d,g,!1,c);a.splice(b-e-f,e+f);b=b-e-f;for(e=d.length-1;e>=0;e--)a.splice(b,0,d[e]);b+=d.length}e=f=0;g=d=""}b++}a.pop();return a};i.prototype.diff_bisect_=function(a,b,c){for(var d=a.length,e=b.length,f=Math.ceil((d+e)/2),g=2*f,h=Array(g),k=Array(g),j=0;j<g;j++)h[j]=-1,k[j]=-1;h[f+1]=0;k[f+1]=0;for(var j=
d-e,p=j%2!=0,r=0,i=0,t=0,n=0,o=0;o<f;o++){if((new Date).getTime()>c)break;for(var s=-o+r;s<=o-i;s+=2){var l=f+s,m;m=s==-o||s!=o&&h[l-1]<h[l+1]?h[l+1]:h[l-1]+1;for(var u=m-s;m<d&&u<e&&a.charAt(m)==b.charAt(u);)m++,u++;h[l]=m;if(m>d)i+=2;else if(u>e)r+=2;else if(p&&(l=f+j-s,l>=0&&l<g&&k[l]!=-1)){var q=d-k[l];if(m>=q)return this.diff_bisectSplit_(a,b,m,u,c)}}for(s=-o+t;s<=o-n;s+=2){l=f+s;q=s==-o||s!=o&&k[l-1]<k[l+1]?k[l+1]:k[l-1]+1;for(m=q-s;q<d&&m<e&&a.charAt(d-q-1)==b.charAt(e-m-1);)q++,m++;k[l]=q;
if(q>d)n+=2;else if(m>e)t+=2;else if(!p&&(l=f+j-s,l>=0&&l<g&&h[l]!=-1&&(m=h[l],u=f+m-l,q=d-q,m>=q)))return this.diff_bisectSplit_(a,b,m,u,c)}}return[[-1,a],[1,b]]};i.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d),a=a.substring(c),b=b.substring(d),f=this.diff_main(f,g,!1,e),e=this.diff_main(a,b,!1,e);return f.concat(e)};i.prototype.diff_linesToChars_=function(a,b){function c(a){for(var b="",c=0,f=-1,g=d.length;f<a.length-1;){f=a.indexOf("\n",c);f==-1&&(f=
a.length-1);var i=a.substring(c,f+1),c=f+1;(e.hasOwnProperty?e.hasOwnProperty(i):e[i]!==void 0)?b+=String.fromCharCode(e[i]):(b+=String.fromCharCode(g),e[i]=g,d[g++]=i)}return b}var d=[],e={};d[0]="";var f=c(a),g=c(b);return[f,g,d]};i.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c][1],e=[],f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}};i.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;for(var c=0,d=Math.min(a.length,
b.length),e=d,f=0;c<e;)a.substring(f,e)==b.substring(f,e)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e};i.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e};i.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(c==0||d==0)return 0;c>d?a=a.substring(c-d):c<d&&
(b=b.substring(0,c));c=Math.min(c,d);if(a==b)return c;for(var d=0,e=1;;){var f=a.substring(c-e),f=b.indexOf(f);if(f==-1)return d;e+=f;if(f==0||a.substring(c-e)==b.substring(0,e))d=e,e++}};i.prototype.diff_halfMatch_=function(a,b){function c(a,b,c){for(var d=a.substring(c,c+Math.floor(a.length/4)),e=-1,g="",h,k,i,m;(e=b.indexOf(d,e+1))!=-1;){var u=f.diff_commonPrefix(a.substring(c),b.substring(e)),q=f.diff_commonSuffix(a.substring(0,c),b.substring(0,e));g.length<q+u&&(g=b.substring(e-q,e)+b.substring(e,
e+u),h=a.substring(0,c-q),k=a.substring(c+u),i=b.substring(0,e-q),m=b.substring(e+u))}return g.length*2>=a.length?[h,k,i,m,g]:null}if(this.Diff_Timeout<=0)return null;var d=a.length>b.length?a:b,e=a.length>b.length?b:a;if(d.length<4||e.length*2<d.length)return null;var f=this,g=c(d,e,Math.ceil(d.length/4)),d=c(d,e,Math.ceil(d.length/2)),h;if(!g&&!d)return null;else h=d?g?g[4].length>d[4].length?g:d:d:g;var k;a.length>b.length?(g=h[0],d=h[1],e=h[2],k=h[3]):(e=h[0],k=h[1],g=h[2],d=h[3]);h=h[4];return[g,
d,e,k,h]};i.prototype.diff_cleanupSemantic=function(a){for(var b=!1,c=[],d=0,e=null,f=0,g=0,h=0,k=0,j=0;f<a.length;)a[f][0]==0?(c[d++]=f,g=k,h=j,j=k=0,e=a[f][1]):(a[f][0]==1?k+=a[f][1].length:j+=a[f][1].length,e!==null&&e.length<=Math.max(g,h)&&e.length<=Math.max(k,j)&&(a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,d--,f=d>0?c[d-1]:-1,j=k=h=g=0,e=null,b=!0)),f++;b&&this.diff_cleanupMerge(a);this.diff_cleanupSemanticLossless(a);for(f=1;f<a.length;){if(a[f-1][0]==-1&&a[f][0]==1){b=a[f-1][1];c=a[f][1];
d=this.diff_commonOverlap_(b,c);if(d>=b.length/2||d>=c.length/2)a.splice(f,0,[0,c.substring(0,d)]),a[f-1][1]=b.substring(0,b.length-d),a[f+1][1]=c.substring(d),f++;f++}f++}};i.prototype.diff_cleanupSemanticLossless=function(a){function b(a,b){if(!a||!b)return 5;var h=0;if(a.charAt(a.length-1).match(c)||b.charAt(0).match(c))if(h++,a.charAt(a.length-1).match(d)||b.charAt(0).match(d))if(h++,a.charAt(a.length-1).match(e)||b.charAt(0).match(e))h++,(a.match(f)||b.match(g))&&h++;return h}for(var c=/[^a-zA-Z0-9]/,
d=/\s/,e=/[\r\n]/,f=/\n\r?\n$/,g=/^\r?\n\r?\n/,h=1;h<a.length-1;){if(a[h-1][0]==0&&a[h+1][0]==0){var k=a[h-1][1],j=a[h][1],p=a[h+1][1],i=this.diff_commonSuffix(k,j);if(i)var v=j.substring(j.length-i),k=k.substring(0,k.length-i),j=v+j.substring(0,j.length-i),p=v+p;for(var i=k,v=j,t=p,n=b(k,j)+b(j,p);j.charAt(0)===p.charAt(0);){k+=j.charAt(0);var j=j.substring(1)+p.charAt(0),p=p.substring(1),o=b(k,j)+b(j,p);o>=n&&(n=o,i=k,v=j,t=p)}a[h-1][1]!=i&&(i?a[h-1][1]=i:(a.splice(h-1,1),h--),a[h][1]=v,t?a[h+1][1]=
t:(a.splice(h+1,1),h--))}h++}};i.prototype.diff_cleanupEfficiency=function(a){for(var b=!1,c=[],d=0,e="",f=0,g=!1,h=!1,k=!1,j=!1;f<a.length;){if(a[f][0]==0)a[f][1].length<this.Diff_EditCost&&(k||j)?(c[d++]=f,g=k,h=j,e=a[f][1]):(d=0,e=""),k=j=!1;else if(a[f][0]==-1?j=!0:k=!0,e&&(g&&h&&k&&j||e.length<this.Diff_EditCost/2&&g+h+k+j==3))a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,e="",g&&h?(k=j=!0,d=0):(d--,f=d>0?c[d-1]:-1,k=j=!1),b=!0;f++}b&&this.diff_cleanupMerge(a)};i.prototype.diff_cleanupMerge=
function(a){a.push([0,""]);for(var b=0,c=0,d=0,e="",f="",g;b<a.length;)switch(a[b][0]){case 1:d++;f+=a[b][1];b++;break;case -1:c++;e+=a[b][1];b++;break;case 0:c+d>1?(c!==0&&d!==0&&(g=this.diff_commonPrefix(f,e),g!==0&&(b-c-d>0&&a[b-c-d-1][0]==0?a[b-c-d-1][1]+=f.substring(0,g):(a.splice(0,0,[0,f.substring(0,g)]),b++),f=f.substring(g),e=e.substring(g)),g=this.diff_commonSuffix(f,e),g!==0&&(a[b][1]=f.substring(f.length-g)+a[b][1],f=f.substring(0,f.length-g),e=e.substring(0,e.length-g))),c===0?a.splice(b-
c-d,c+d,[1,f]):d===0?a.splice(b-c-d,c+d,[-1,e]):a.splice(b-c-d,c+d,[-1,e],[1,f]),b=b-c-d+(c?1:0)+(d?1:0)+1):b!==0&&a[b-1][0]==0?(a[b-1][1]+=a[b][1],a.splice(b,1)):b++,c=d=0,f=e=""}a[a.length-1][1]===""&&a.pop();c=!1;for(b=1;b<a.length-1;)a[b-1][0]==0&&a[b+1][0]==0&&(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]?(a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length),a[b+1][1]=a[b-1][1]+a[b+1][1],a.splice(b-1,1),c=!0):a[b][1].substring(0,a[b+1][1].length)==a[b+1][1]&&
(a[b-1][1]+=a[b+1][1],a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1],a.splice(b+1,1),c=!0)),b++;c&&this.diff_cleanupMerge(a)};i.prototype.diff_xIndex=function(a,b){var c=0,d=0,e=0,f=0,g;for(g=0;g<a.length;g++){a[g][0]!==1&&(c+=a[g][1].length);a[g][0]!==-1&&(d+=a[g][1].length);if(c>b)break;e=c;f=d}return a.length!=g&&a[g][0]===-1?f:f+(b-e)};i.prototype.diff_prettyHtml=function(a){for(var b=[],c=0,d=/&/g,e=/</g,f=/>/g,g=/\n/g,h=0;h<a.length;h++){var k=a[h][0],j=a[h][1],i=j.replace(d,"&amp;").replace(e,
"&lt;").replace(f,"&gt;").replace(g,"&para;<br>");switch(k){case 1:b[h]='<ins style="background:#e6ffe6;">'+i+"</ins>";break;case -1:b[h]='<del style="background:#ffe6e6;">'+i+"</del>";break;case 0:b[h]="<span>"+i+"</span>"}k!==-1&&(c+=j.length)}return b.join("")};i.prototype.diff_text1=function(a){for(var b=[],c=0;c<a.length;c++)a[c][0]!==1&&(b[c]=a[c][1]);return b.join("")};i.prototype.diff_text2=function(a){for(var b=[],c=0;c<a.length;c++)a[c][0]!==-1&&(b[c]=a[c][1]);return b.join("")};i.prototype.diff_levenshtein=
function(a){for(var b=0,c=0,d=0,e=0;e<a.length;e++){var f=a[e][1];switch(a[e][0]){case 1:c+=f.length;break;case -1:d+=f.length;break;case 0:b+=Math.max(c,d),d=c=0}}b+=Math.max(c,d);return b};i.prototype.diff_toDelta=function(a){for(var b=[],c=0;c<a.length;c++)switch(a[c][0]){case 1:b[c]="+"+encodeURI(a[c][1]);break;case -1:b[c]="-"+a[c][1].length;break;case 0:b[c]="="+a[c][1].length}return b.join("\t").replace(/%20/g," ")};i.prototype.diff_fromDelta=function(a,b){for(var c=[],d=0,e=0,f=b.split(/\t/g),
g=0;g<f.length;g++){var h=f[g].substring(1);switch(f[g].charAt(0)){case "+":try{c[d++]=[1,decodeURI(h)]}catch(k){throw Error("Illegal escape in diff_fromDelta: "+h);}break;case "-":case "=":var j=parseInt(h,10);if(isNaN(j)||j<0)throw Error("Invalid number in diff_fromDelta: "+h);h=a.substring(e,e+=j);f[g].charAt(0)=="="?c[d++]=[0,h]:c[d++]=[-1,h];break;default:if(f[g])throw Error("Invalid diff operation in diff_fromDelta: "+f[g]);}}if(e!=a.length)throw Error("Delta length ("+e+") does not equal source text length ("+
a.length+").");return c};i.prototype.match_main=function(a,b,c){if(a==null||b==null||c==null)throw Error("Null input. (match_main)");c=Math.max(0,Math.min(c,a.length));return a==b?0:a.length?a.substring(c,c+b.length)==b?c:this.match_bitap_(a,b,c):-1};i.prototype.match_bitap_=function(a,b,c){function d(a,d){var e=a/b.length,g=Math.abs(c-d);return!f.Match_Distance?g?1:e:e+g/f.Match_Distance}if(b.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var e=this.match_alphabet_(b),
f=this,g=this.Match_Threshold,h=a.indexOf(b,c);h!=-1&&(g=Math.min(d(0,h),g),h=a.lastIndexOf(b,c+b.length),h!=-1&&(g=Math.min(d(0,h),g)));for(var k=1<<b.length-1,h=-1,j,i,r=b.length+a.length,v,t=0;t<b.length;t++){j=0;for(i=r;j<i;)d(t,c+i)<=g?j=i:r=i,i=Math.floor((r-j)/2+j);r=i;j=Math.max(1,c-i+1);var n=Math.min(c+i,a.length)+b.length;i=Array(n+2);for(i[n+1]=(1<<t)-1;n>=j;n--){var o=e[a.charAt(n-1)];i[n]=t===0?(i[n+1]<<1|1)&o:(i[n+1]<<1|1)&o|(v[n+1]|v[n])<<1|1|v[n+1];if(i[n]&k&&(o=d(t,n-1),o<=g))if(g=
o,h=n-1,h>c)j=Math.max(1,2*c-h);else break}if(d(t+1,c)>g)break;v=i}return h};i.prototype.match_alphabet_=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=0;for(c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b};i.prototype.patch_addContext_=function(a,b){if(b.length!=0){for(var c=b.substring(a.start2,a.start2+a.length1),d=0;b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)d+=this.Patch_Margin,c=b.substring(a.start2-d,a.start2+a.length1+
d);d+=this.Patch_Margin;(c=b.substring(a.start2-d,a.start2))&&a.diffs.unshift([0,c]);(d=b.substring(a.start2+a.length1,a.start2+a.length1+d))&&a.diffs.push([0,d]);a.start1-=c.length;a.start2-=c.length;a.length1+=c.length+d.length;a.length2+=c.length+d.length}};i.prototype.patch_make=function(a,b,c){var d;if(typeof a=="string"&&typeof b=="string"&&typeof c=="undefined")d=a,b=this.diff_main(d,b,!0),b.length>2&&(this.diff_cleanupSemantic(b),this.diff_cleanupEfficiency(b));else if(a&&typeof a=="object"&&
typeof b=="undefined"&&typeof c=="undefined")b=a,d=this.diff_text1(b);else if(typeof a=="string"&&b&&typeof b=="object"&&typeof c=="undefined")d=a;else if(typeof a=="string"&&typeof b=="string"&&c&&typeof c=="object")d=a,b=c;else throw Error("Unknown call format to patch_make.");if(b.length===0)return[];for(var c=[],a=new w,e=0,f=0,g=0,h=d,k=0;k<b.length;k++){var j=b[k][0],i=b[k][1];if(!e&&j!==0)a.start1=f,a.start2=g;switch(j){case 1:a.diffs[e++]=b[k];a.length2+=i.length;d=d.substring(0,g)+i+d.substring(g);
break;case -1:a.length1+=i.length;a.diffs[e++]=b[k];d=d.substring(0,g)+d.substring(g+i.length);break;case 0:i.length<=2*this.Patch_Margin&&e&&b.length!=k+1?(a.diffs[e++]=b[k],a.length1+=i.length,a.length2+=i.length):i.length>=2*this.Patch_Margin&&e&&(this.patch_addContext_(a,h),c.push(a),a=new w,e=0,h=d,f=g)}j!==1&&(f+=i.length);j!==-1&&(g+=i.length)}e&&(this.patch_addContext_(a,h),c.push(a));return c};i.prototype.patch_deepCopy=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=new w;e.diffs=
[];for(var f=0;f<d.diffs.length;f++)e.diffs[f]=d.diffs[f].slice();e.start1=d.start1;e.start2=d.start2;e.length1=d.length1;e.length2=d.length2;b[c]=e}return b};i.prototype.patch_apply=function(a,b){if(a.length==0)return[b,[]];var a=this.patch_deepCopy(a),c=this.patch_addPadding(a),b=c+b+c;this.patch_splitMax(a);for(var d=0,e=[],f=0;f<a.length;f++){var g=a[f].start2+d,h=this.diff_text1(a[f].diffs),i,j=-1;if(h.length>this.Match_MaxBits){if(i=this.match_main(b,h.substring(0,this.Match_MaxBits),g),i!=
-1&&(j=this.match_main(b,h.substring(h.length-this.Match_MaxBits),g+h.length-this.Match_MaxBits),j==-1||i>=j))i=-1}else i=this.match_main(b,h,g);if(i==-1)e[f]=!1,d-=a[f].length2-a[f].length1;else if(e[f]=!0,d=i-g,g=j==-1?b.substring(i,i+h.length):b.substring(i,j+this.Match_MaxBits),h==g)b=b.substring(0,i)+this.diff_text2(a[f].diffs)+b.substring(i+h.length);else if(g=this.diff_main(h,g,!1),h.length>this.Match_MaxBits&&this.diff_levenshtein(g)/h.length>this.Patch_DeleteThreshold)e[f]=!1;else{this.diff_cleanupSemanticLossless(g);
for(var h=0,p,j=0;j<a[f].diffs.length;j++){var r=a[f].diffs[j];r[0]!==0&&(p=this.diff_xIndex(g,h));r[0]===1?b=b.substring(0,i+p)+r[1]+b.substring(i+p):r[0]===-1&&(b=b.substring(0,i+p)+b.substring(i+this.diff_xIndex(g,h+r[1].length)));r[0]!==-1&&(h+=r[1].length)}}}b=b.substring(c.length,b.length-c.length);return[b,e]};i.prototype.patch_addPadding=function(a){for(var b=this.Patch_Margin,c="",d=1;d<=b;d++)c+=String.fromCharCode(d);for(d=0;d<a.length;d++)a[d].start1+=b,a[d].start2+=b;var d=a[0],e=d.diffs;
if(e.length==0||e[0][0]!=0)e.unshift([0,c]),d.start1-=b,d.start2-=b,d.length1+=b,d.length2+=b;else if(b>e[0][1].length){var f=b-e[0][1].length;e[0][1]=c.substring(e[0][1].length)+e[0][1];d.start1-=f;d.start2-=f;d.length1+=f;d.length2+=f}d=a[a.length-1];e=d.diffs;e.length==0||e[e.length-1][0]!=0?(e.push([0,c]),d.length1+=b,d.length2+=b):b>e[e.length-1][1].length&&(f=b-e[e.length-1][1].length,e[e.length-1][1]+=c.substring(0,f),d.length1+=f,d.length2+=f);return c};i.prototype.patch_splitMax=function(a){for(var b=
this.Match_MaxBits,c=0;c<a.length;c++)if(a[c].length1>b){var d=a[c];a.splice(c--,1);for(var e=d.start1,f=d.start2,g="";d.diffs.length!==0;){var h=new w,i=!0;h.start1=e-g.length;h.start2=f-g.length;if(g!=="")h.length1=h.length2=g.length,h.diffs.push([0,g]);for(;d.diffs.length!==0&&h.length1<b-this.Patch_Margin;){var g=d.diffs[0][0],j=d.diffs[0][1];g===1?(h.length2+=j.length,f+=j.length,h.diffs.push(d.diffs.shift()),i=!1):g===-1&&h.diffs.length==1&&h.diffs[0][0]==0&&j.length>2*b?(h.length1+=j.length,
e+=j.length,i=!1,h.diffs.push([g,j]),d.diffs.shift()):(j=j.substring(0,b-h.length1-this.Patch_Margin),h.length1+=j.length,e+=j.length,g===0?(h.length2+=j.length,f+=j.length):i=!1,h.diffs.push([g,j]),j==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(j.length))}g=this.diff_text2(h.diffs);g=g.substring(g.length-this.Patch_Margin);j=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);j!==""&&(h.length1+=j.length,h.length2+=j.length,h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===
0?h.diffs[h.diffs.length-1][1]+=j:h.diffs.push([0,j]));i||a.splice(++c,0,h)}}};i.prototype.patch_toText=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b.join("")};i.prototype.patch_fromText=function(a){var b=[];if(!a)return b;for(var a=a.split("\n"),c=0,d=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;c<a.length;){var e=a[c].match(d);if(!e)throw Error("Invalid patch string: "+a[c]);var f=new w;b.push(f);f.start1=parseInt(e[1],10);e[2]===""?(f.start1--,f.length1=1):e[2]=="0"?f.length1=0:(f.start1--,
f.length1=parseInt(e[2],10));f.start2=parseInt(e[3],10);e[4]===""?(f.start2--,f.length2=1):e[4]=="0"?f.length2=0:(f.start2--,f.length2=parseInt(e[4],10));for(c++;c<a.length;){e=a[c].charAt(0);try{var g=decodeURI(a[c].substring(1))}catch(h){throw Error("Illegal escape in patch_fromText: "+g);}if(e=="-")f.diffs.push([-1,g]);else if(e=="+")f.diffs.push([1,g]);else if(e==" ")f.diffs.push([0,g]);else if(e=="@")break;else if(e!=="")throw Error('Invalid patch mode "'+e+'" in: '+g);c++}}return b};w.prototype.toString=
function(){var a,b;a=this.length1===0?this.start1+",0":this.length1==1?this.start1+1:this.start1+1+","+this.length1;b=this.length2===0?this.start2+",0":this.length2==1?this.start2+1:this.start2+1+","+this.length2;a=["@@ -"+a+" +"+b+" @@\n"];var c;for(b=0;b<this.diffs.length;b++){switch(this.diffs[b][0]){case 1:c="+";break;case -1:c="-";break;case 0:c=" "}a[b+1]=c+encodeURI(this.diffs[b][1])+"\n"}return a.join("").replace(/%20/g," ")};window.diff_match_patch=i;window.patch_obj=w;window.DIFF_DELETE=
-1;window.DIFF_INSERT=1;window.DIFF_EQUAL=0})();

// PAGEDOWN (Markdown handler)
// http://code.google.com/p/pagedown/
var Markdown;Markdown=typeof exports==="object"&&typeof require==="function"?exports:{};
(function(){function q(d){return d}function s(){return!1}function t(){}function u(){}t.prototype={chain:function(d,h){var j=this[d];if(!j)throw Error("unknown hook "+d);this[d]=j===q?h:function(d){return h(j(d))}},set:function(d,h){if(!this[d])throw Error("unknown hook "+d);this[d]=h},addNoop:function(d){this[d]=q},addFalse:function(d){this[d]=s}};Markdown.HookCollection=t;u.prototype={set:function(d,h){this["s_"+d]=h},get:function(d){return this["s_"+d]}};Markdown.Converter=function(){function d(a){return a=
a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,b,c,f,F,d){b=b.toLowerCase();k.set(b,z(c));if(F)return f;else d&&l.set(b,d.replace(/"/g,"&quot;"));return""})}function h(a){a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,j);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,
j);a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,j);a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,j);return a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,j)}function j(a,e){var b;b=e.replace(/^\n+/,"");b=b.replace(/\n+$/g,"");return b="\n\n~K"+(o.push(b)-1)+"K\n\n"}function v(a,e){var a=s(a),a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n"),a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,"<hr />\n"),
a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n"),a=A(a),a=G(a),a=H(a),a=h(a),b;b=a.replace(/^\n+/g,"");b=b.replace(/\n+$/g,"");var c=b.split(/\n{2,}/g);b=[];for(var f=c.length,d=0;d<f;d++){var i=c[d];i.search(/~K(\d+)K/g)>=0?b.push(i):i.search(/\S/)>=0&&(i=p(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",b.push(i))}if(!e){f=b.length;for(d=0;d<f;d++)for(;b[d].search(/~K(\d+)K/)>=0;)c=o[RegExp.$1],c=c.replace(/\$/g,"$$$$"),b[d]=b[d].replace(/~K\d+K/,c)}return a=b.join("\n\n")}function p(a){a=
I(a);a=q(a);a=a.replace(/\\(\\)/g,w);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,w);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,B);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,B);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,x);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,x);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,x);a=J(a);a=z(a);a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,
"$1<strong>$3</strong>$4");a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4");return a=a.replace(/  +\n/g," <br>\n")}function q(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=m(b,a.charAt(1)=="!"?"\\`*_/":"\\`*_")})}function x(a,e,b,c,f,d,i,g){g==void 0&&(g="");a=c.toLowerCase();if(f=="")if(a==""&&(a=b.toLowerCase().replace(/ ?\n/g," ")),k.get(a)!=
void 0)f=k.get(a),l.get(a)!=void 0&&(g=l.get(a));else if(e.search(/\(\s*\)$/m)>-1)f="";else return e;f=K(f);f=m(f,"*_");e='<a href="'+f+'"';g!=""&&(g=g.replace(/"/g,"&quot;"),g=m(g,"*_"),e+=' title="'+g+'"');e+=">"+b+"</a>";return e}function B(a,e,b,c,f,d,i,g){a=b;c=c.toLowerCase();g||(g="");if(f=="")if(c==""&&(c=a.toLowerCase().replace(/ ?\n/g," ")),k.get(c)!=void 0)f=k.get(c),l.get(c)!=void 0&&(g=l.get(c));else return e;a=a.replace(/"/g,"&quot;");f=m(f,"*_");e='<img src="'+f+'" alt="'+a+'"';g=g.replace(/"/g,
"&quot;");g=m(g,"*_");e+=' title="'+g+'"';e+=" />";return e}function s(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+p(b)+"</h1>\n\n"});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+p(b)+"</h2>\n\n"});return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){a=b.length;return"<h"+a+">"+p(c)+"</h"+a+">\n\n"})}function A(a){a+="~0";var e=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;r?a=a.replace(e,
function(a,c,e){a=e.search(/[*+-]/g)>-1?"ul":"ol";c=C(c,a);c=c.replace(/\s+$/,"");return"<"+a+">"+c+"</"+a+">\n"}):(e=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(e,function(a,c,e,d){a=d.search(/[*+-]/g)>-1?"ul":"ol";e=C(e,a);return c+"<"+a+">\n"+e+"</"+a+">\n"}));return a=a.replace(/~0/,"")}function C(a,e){r++;a=a.replace(/\n{2,}$/,"\n");a+="~0";var b=L[e],c=!1,a=a.replace(RegExp("(^[ \\t]*)("+b+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+
b+")[ \\t]+))","gm"),function(a,b,e,d){a=d;(b=/\n\n$/.test(a))||a.search(/\n{2,}/)>-1||c?a=v(y(a),!0):(a=A(y(a)),a=a.replace(/\n$/,""),a=p(a));c=b;return"<li>"+a+"</li>\n"}),a=a.replace(/~0/g,"");r--;return a}function G(a){a+="~0";a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){a=D(y(b));a=E(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");return"\n\n"+("<pre><code>"+a+"\n</code></pre>")+"\n\n"+c});return a=a.replace(/~0/,"")}function M(a){a=a.replace(/(^\n+|\n+$)/g,
"");return"\n\n~K"+(o.push(a)-1)+"K\n\n"}function I(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=D(a);return b+"<code>"+a+"</code>"})}function D(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a=m(a,"*_{}[]\\",!1)}function H(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,
"");c=v(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return M("<blockquote>\n"+c+"\n</blockquote>")})}function z(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function J(a){a=a.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");return a=a.replace(/<((https?|ftp):[^'">\s]+)>/gi,
function(a,b){return'<a href="'+b+'">'+n.plainLinkText(b)+"</a>"})}function N(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})}function y(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")}function E(a){if(!/\t/.test(a))return a;var d=["    ","   ","  "," "],b=0,c;return a.replace(/[\n\t]/g,function(a,h){if(a==="\n")return b=h+1,a;c=(h-b)%4;b=h+1;return d[c]})}function K(a){if(!a)return"";var d=a.length;return a.replace(O,function(b,
c){if(b=="~D")return"%24";if(b==":"&&(c==d-1||/[0-9\/]/.test(a.charAt(c+1))))return":";return"%"+b.charCodeAt(0).toString(16)})}function m(a,d,b){d="(["+d.replace(/([\[\]\\])/g,"\\$1")+"])";b&&(d="\\\\"+d);return a=a.replace(RegExp(d,"g"),w)}function w(a,d){return"~E"+d.charCodeAt(0)+"E"}var n=this.hooks=new t;n.addNoop("plainLinkText");n.addNoop("preConversion");n.addNoop("postConversion");var k,l,o,r;this.makeHtml=function(a){if(k)throw Error("Recursive call to converter.makeHtml");k=new u;l=new u;
o=[];r=0;a=n.preConversion(a);a=a.replace(/~/g,"~T");a=a.replace(/\$/g,"~D");a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");a=E("\n\n"+a+"\n\n");a=a.replace(/^[ \t]+$/mg,"");a=h(a);a=d(a);a=v(a);a=N(a);a=a.replace(/~D/g,"$$");a=a.replace(/~T/g,"~");a=n.postConversion(a);o=l=k=null;return a};var L={ol:"\\d+[.]",ul:"[*+-]"},O=/(?:["'*()[\]:]|~D)/g}})();

// NOTESTACK CODE
// http://notestack.me
var notestack=function(){var a=jQuery.noConflict(),s,t,u=function(b){"off"===b?(a("html body").removeClass("fullscreen-mode"),a(".overlay").removeClass("show")):"on"===b?(a("html body").addClass("fullscreen-mode"),a(".overlay").addClass("show")):(a("html body").toggleClass("fullscreen-mode"),a(".overlay").toggleClass("show"))},i=function(){a(".show").not(".settings_pane,.msg").removeClass("show");u("off")},q=function(b,d){0===a(".status .progress .inner").length&&a(".status").html('<div class="progress"><div class="inner"></div></div>');
a(".status .progress .inner").animate({width:b+"%"},250,d)},R=a.throttle(500,!0,q),w=function(b){"clear"===b?(a(".msg .inner").text(""),a(".msg").removeClass("show")):(a(".msg .inner").text(b),a(".msg").addClass("show"))},S=function(){return a.Deferred(function(b){a.ajax("/sn.php",{type:"POST",data:{action:"tagIndex",email:localStorage.email,token:localStorage.token},timeout:3E3,success:function(a){if("401"===a)window.location="/?login=expired";localStorage.tagIndex=a;b.resolve()},error:function(){a(".status").text("Working offline. Changes will sync when connected.");
a(".status-div").removeClass("loading")}})})},G=function(b){return a.Deferred(function(d){a.ajax("/sn.php",{type:"POST",data:b,timeout:5E3,success:function(c){var e,f,g,h,l;if("401"===c)window.location="/?login=expired";c=a.parseJSON(c);if(localStorage.index){e=a.parseJSON(localStorage.index);for(f=0,g=c.data.length;f<g;f+=1){for(h=0,l=e.data.length;h<l;h+=1)if(e.data[h].key===c.data[f].key){e.data.splice(h,1);break}e.data.push(c.data[f])}e.count=e.data.length}else e=c;localStorage.setItem("mark",
c.mark||"DONE");localStorage.setItem("index",JSON.stringify(e));localStorage.setItem("indexDate",c.time);"DONE"===localStorage.mark?(localStorage.removeItem("mark"),d.resolve()):(b.mark=localStorage.mark,a.when(G(b)).done(function(){d.resolve()}))},error:function(){a(".status").text("Working offline. Changes will sync when connected.");a(".status-div").removeClass("loading")}})}).promise()},m=function(b){return a.Deferred(function(d){var c=a.parseJSON(localStorage.getItem(b));if(1!==c.deleted){0<
a("#list-"+c.key).length?a("#list-"+c.key).removeData().data(c):a("#listnote-template").clone().attr("id","list-"+c.key).addClass("listnote").appendTo(".list").data(c);c=a("#list-"+c.key);c.removeClass("pinned");-1<c.data().systemtags.indexOf("pinned")&&c.addClass("pinned");var e=c.data().content.indexOf("\n");0>e?(c.children(".title").text(c.data().content.substring(0,100)),c.children(".preview").text("")):(c.children(".title").text(c.data().content.substring(0,e)),c.children(".preview").text(c.data().content.substr(e,
100)));d.resolve()}}).promise()},p=function(){a(".listnote").sortElements(function(b,d){if(a(b).hasClass("pinned")){if(!a(d).hasClass("pinned"))return-1}else if(a(d).hasClass("pinned")&&!a(b).hasClass("pinned"))return 1;return localStorage.sortby&&"sortby-alphabetic"==localStorage.sortby?a(b).data("content").toLowerCase()>a(d).data("content").toLowerCase()?1:-1:parseFloat(a(b).data("modifydate"))<parseFloat(a(d).data("modifydate"))?1:-1});return"sorted"},v=function(){var b=a("#"+a(".selected").data().key),
d=b.prevAll(".on").eq(1),c=b.prevAll(".on").eq(0),e=b.nextAll(".on").eq(0),f=b.nextAll(".on").eq(1);b.hasClass("current")||(a(".current").removeClass("current"),b.addClass("current"));d.hasClass("prev2")||(a(".prev2").removeClass("prev2"),d.addClass("prev2"));c.hasClass("prev1")||(a(".prev1").removeClass("prev1"),c.addClass("prev1"));e.hasClass("next1")||(a(".next1").removeClass("next1"),e.addClass("next1"));f.hasClass("next2")||(a(".next2").removeClass("next2"),f.addClass("next2"))},T=function(a){return a.replace(/\n/g,
"<br>").replace(/\r/g,"")},n=function(){var b,d,c,e,f;1!==a(".selected").length&&(a(".selected").removeClass("selected"),a(".listnote:visible:first").addClass("selected"));c=a.parseJSON(localStorage.tagIndex).tags;e=[];for(b=0,d=c.length;b<d;b+=1)e.push(c[b].name);var g=function(b){var c,d,g;a("#note-template").clone().attr("id",b.key).addClass("note").insertAfter(f);c=a("#"+b.key);c.data("syncnum",b.syncnum);c.children(".textarea").children(".ta-inner").children("textarea").val(b.content);d=b.tags.join(" ");
g=c.children(".textarea").children(".tag-area").children("input");g.val(d);g.tagit({singleFieldDelimiter:" ",availableTags:e}).tagit({onTagAdded:function(){x(a(".current").attr("id"))},onTagRemoved:function(b,c){var e=c.children(".tagit-label").text();x(a(".current").attr("id"),e)}});c.addClass("on");-1<a.inArray("markdown",b.systemtags)&&r(b.key,"on");-1<a.inArray("pinned",b.systemtags)&&c.addClass("pinned");y("#"+b.key+" .textarea textarea")};f=a(".notes-placeholder");a(".listnote").each(function(){var b=
a(this).data(),c=0<a("#"+b.key).length,e=c?a("#"+b.key):!1;"none"===a(this).css("display")?c&&e.removeClass("on").removeClass("current").removeClass("prev1").removeClass("prev2").removeClass("next1").removeClass("next2"):c?(b.syncnum>e.data().syncnum?(e.remove(),g(b),e=a("#"+b.key)):e.addClass("on"),e.insertAfter(f)):(g(b),e=a("#"+b.key));f=e});v()},H=function(b){var d=a.Deferred(),c={action:"sendnote",email:s,token:t,notekey:b.key,notebody:encodeURIComponent(JSON.stringify(b))},e=0;if("notestack"===
b.key.substr(0,9))delete c.notekey,delete b.key,c.notebody=encodeURIComponent(JSON.stringify(b)),e=1;a.ajax("/sn.php",{type:"POST",data:c,success:function(c){var g,h,l,c=a.parseJSON(c);if(void 0===c.content)c.content=b.content;if(1===e){g=a.parseJSON(localStorage.index);for(h=0,l=g.data.length;h<l;h+=1)if("notestack"===g.data[h].key.substr(0,9)){a("#list-"+g.data[h].key).remove();localStorage.removeItem(g.data[h].key);g.data.splice(h,1);break}localStorage.index=JSON.stringify(g)}localStorage.setItem(c.key,
JSON.stringify(c));m(c.key);a("#list-"+c.key).addClass("selected");p();n();d.resolve()},error:function(){}});return d.promise()},I=function(b){return a.Deferred(function(d){a.ajax("/sn.php",{type:"POST",data:{action:"note",email:s,token:t,notekey:b},success:function(b){var e;e=a.parseJSON(b);localStorage.setItem(e.key,b);m(e.key);d.resolve()},error:function(){}})}).promise()},U=function(){return a.Deferred(function(b){function d(j){var i,o;for(e=g,f=g+j;e<=f;e+=1){R(50+Math.round(50*(e/c.data.length)));
if(!c.data[e]){b.resolve();o=!0;break}localStorage.getItem(c.data[e].key)?(i=a.parseJSON(localStorage.getItem(c.data[e].key)),"notestack"===i.key.substr(0,9)?h.push(H(i)):i.syncnum<c.data[e].syncnum?h.push(I(i.key)):i.syncnum>c.data[e].syncnum?h.push(H(i)):m(i.key)):h.push(I(c.data[e].key));0===c.data[e].deleted?l+=1:1===c.data[e].deleted&&(k+=1)}if(!0===o)return a(".note-data").text(l+" notes | "),a(".data_notes").text(l),a(".data_deleted").text(k),!1;0<h.length?a.when.apply(null,h).done(function(){g+=
j+1;h=[];p();n();d(j)}):(g=g+j+1,h=[],d(j))}var c,e,f,g=0,h=[],l=0,k=0;c=a.parseJSON(localStorage.index);d(20)}).promise()},J=function(a){a=parseFloat(a);return(new Date(1E3*a)).toISOString()},o=function(b){q(5);localStorage.token?a.when(S()).done(function(){var d,c;q(25);"full"===b?c=d="":localStorage.mark?(d="",c=localStorage.mark):(d=localStorage.indexDate||"",c="");s=localStorage.email;t=localStorage.token;a.when(G({action:"index",email:s,token:t,since:d,mark:c,length:100})).done(function(){q(50);
(new Date).getTime();a.when(U()).done(function(){q(100,function(){var b;b=J(localStorage.indexDate);a(".status").html('synced <abbr class="timeago" title="'+b+'"></abbr>');a(".timeago").timeago();a(".status-div").removeClass("loading");p();n()})})})}):window.location="/"},r=function(b,d,c){b=b||a(".current").attr("id");void 0===d&&(d=a("#"+b).hasClass("markdown-on")?"off":"on");"temp"!==c&&(c="stick");var e=a("#"+b),b=a("#list-"+b),f=b.data(),g=e.children(".textarea");if("on"===d)e.removeClass("markdown-off").addClass("markdown-on"),
c=(new Markdown.Converter).makeHtml("# "+g.children(".ta-inner").children("textarea").val()),g.children(".ta-inner").replaceWith('<div class="markdown">'+c+"</div>"),g.children(".markdown").children("h1:first").addClass("first-h1"),g.children(".markdown").children("p").each(function(){a(this).html(T(a(this).html()))}),0>a.inArray("markdown",f.systemtags)&&(f.systemtags.push("markdown"),f.syncnum+=1,localStorage.setItem(f.key,JSON.stringify(b.data())),m(f.key),o());else if("off"===d)e.removeClass("markdown-on").addClass("markdown-off"),
d=f.content,g.children(".markdown").replaceWith('<div class="ta-inner"><textarea>'+d+"</textarea></div>"),y(g.children(".ta-inner").children("textarea")),"stick"===c&&(c=b.data().systemtags.indexOf("markdown"),-1<c&&f.systemtags.splice(c,1),f.syncnum+=1,localStorage.setItem(f.key,JSON.stringify(b.data())),m(f.key),o())},x=function(b,d){var c,e;c=a("#"+b+" .tag-area input").val().split(" ");e=c.indexOf(d);-1!==e&&c.splice(e,1);e=a.parseJSON(localStorage[b]);if(e.tags!==c)e.tags=c,e.syncnum+=1,localStorage[b]=
JSON.stringify(e),m(b),o()},z=function(){var b=a(".search input").val().toLowerCase().split(" ");a(".listnote").each(function(){var d=a(this).data().content.toLowerCase(),c,e;for(c=0,e=b.length;c<e;c+=1)if(-1<d.indexOf(b[c]))a(this).removeClass("search-hide");else{a(this).addClass("search-hide");break}});0===a(".selected:not(.search-hide,.tag-hide)").length&&(a(".selected").removeClass("selected"),a(".listnote:not(.search-hide,.tag-hide):first").addClass("selected"));n()},y=function(b){a(b).bind("keydown",
"esc",function(){a(".note-directions").removeClass("show");a(this).blur()});a(b).tabby();a(".maximize").click(function(){u()});a(".tagsinput div input").blur(function(){x(a(".current").attr("id"))})},K=function(){0>a(".selected").position().top?a(".list").scrollTop(a(".list").scrollTop()+a(".selected").position().top):a(".selected").position().top+a(".listnote").height()>a(".list").height()&&a(".list").scrollTop(a(".list").scrollTop()+a(".selected").position().top-a(".list").height()+a(".listnote").height())},
k=function(){a(".selected").nextAll(".listnote:not(.hide):first");var b=a(".selected").nextAll(".listnote:visible:first");0<b.length&&(a(".selected").removeClass("selected"),b.addClass("selected"),a(".prev2").removeClass("prev2"),a(".prev1").addClass("prev2").removeClass("prev1"),a(".current").addClass("prev1").removeClass("current"),a(".next1").addClass("current").removeClass("next1"),a(".next2").addClass("next1").removeClass("next2"),a(".next1").nextAll(".on").eq(0).addClass("next2"),K())},j=function(){var b=
a(".selected").prevAll(".listnote:visible:first");0<b.length&&(a(".selected").removeClass("selected"),b.addClass("selected"),a(".next2").removeClass("next2"),a(".next1").removeClass("next1").addClass("next2"),a(".current").removeClass("current").addClass("next1"),a(".prev1").removeClass("prev1").addClass("current"),a(".prev2").removeClass("prev2").addClass("prev1"),a(".prev1").prevAll(".on").eq(0).addClass("prev2"),K())},L=function(b){w("Working...");void 0===b&&-1<a(".selected").length&&(b=a(".selected"));
-1<b.data().systemtags.indexOf("pinned")?b.data().systemtags.splice(b.data().systemtags.indexOf("pinned"),1):b.data().systemtags.push("pinned");b.data().syncnum=b.data().syncnum+1;localStorage.setItem(b.data().key,JSON.stringify(b.data()));m(b.data().key);p();n();w("clear")},M=function(){var b,d,c;b=(new Date).getTime();d="notestack"+b;b={key:d,createdate:b/1E3,modifydate:b/1E3,tags:[],systemtags:[],content:"new note"};localStorage.setItem(d,JSON.stringify(b));c=a.parseJSON(localStorage.index);c.data.push(b);
localStorage.index=JSON.stringify(c);m(d);p();a(".selected").removeClass("selected");a("#list-"+d).addClass("selected");n();a(".current .textarea textarea").select()},N=function(){a("html body").removeClass("tag-filter");a(".active-tag-filter").remove();a(".listnote").removeClass("tag-hide");a(".selected").removeClass("selected");a(".listnote:not(.search-hide,.tag-hide):first").addClass("selected");a(".search input").val("");z()},V=function(){a(".version-item").sortElements(function(b,d){return parseFloat(a(b).data("version"))<
parseFloat(a(d).data("version"))?1:-1});return"sorted"},W=function(b,d){return a.Deferred(function(c){a.ajax("/sn.php",{type:"POST",data:{action:"noteversion",email:s,token:t,notekey:b,noteversion:d},success:function(e){e=a.parseJSON(e);a("#version-template").clone().attr("id",b+"version"+e.version).addClass("version-item").appendTo(".versions .versions-left").data(e);a("#"+b+"version"+e.version).children(".version-date").html('<abbr class="timeago" title="'+J(e.versiondate)+'"></abbr>');a(".timeago").timeago();
V();c.resolve()},error:function(){return"false"}})}).promise()},X=function(b){a(".version-item").remove();for(var d=[],c=a.parseJSON(localStorage.getItem(b)),e=c.version,f=c.minversion,c=f;c<=e;c+=1)d.push(W(b,c));a.when.apply(null,d).done(function(){a(".version-item").each(function(){if(a(this).data().version>f){var c=a(this).data().version-1,e=a("#"+b+"version"+c).data().content,d=a(this).data().content,c=new Diff_Match_Patch,e=c.diff_main(e,d);c.diff_cleanupSemantic(e);c=c.diff_prettyHtml(e);a(this).data("diff",
c)}else a(this).data().version===f&&a(this).data("diff",a(this).data().content)});a(".versions-right .right-inner").html(a(".version-item:first").data().diff);a(".version-item:first").addClass("version-select")})},O=function(b){a(".versions").hasClass("show")?i():(u("off"),a(".versions").addClass("show"),a(".overlay").addClass("show"),a(".versions-right .right-inner").html(""),X(b))},Y=function(){a(".labels .item").remove();var b=a.parseJSON(localStorage.tagIndex);a(".listnote");var d,c,e,f,g;for(d=
0,c=b.count;d<c;d+=1)e=b.tags[d].name,f=e.replace("@","").replace(".",""),g=0,a(".listnote").each(function(){a(this).data();-1<a.inArray(e,a(this).data().tags)&&(g+=1)}),a("#label-template").clone().attr("id",f).addClass("item").appendTo(".labels .items"),a("#"+f).children(".name").html("<pre>"+e+"</pre>"),a("#"+f).children(".notecount").text(g+" notes");a(".labels .item").sortElements(function(b,c){return parseFloat(a(b).children(".notecount").text())<parseFloat(a(c).children(".notecount").text())?
1:-1})},A=function(){a(".labels").hasClass("show")?i():(u("off"),Y(),a(".labels").addClass("show"),a(".overlay").addClass("show"),a(".labels input").val("").select());return!1},P=function(){var b=a(".labels input").val().toLowerCase();a(".labels .item").each(function(){-1<a(this).children(".name").text().toLowerCase().indexOf(b)?a(this).removeClass("hide"):a(this).addClass("hide")});a(".label-select").removeClass("label-select");a(".labels .item:not(.hide):first").addClass("label-select")},Q=function(b){a(".tag-hide").removeClass("tag-hide");
a(".active-tag-filter").remove();"partial"!==b&&(a("html body").removeClass("tag-filter"),a(".selected").removeClass("selected"),a(".listnote:not(.search-hide,.tag-hide):first").addClass("selected"),n())},B=function(b){w("Working...");a(".labels input").val("").blur();i();Q("partial");a("html body").addClass("tag-filter");a("#tag-filter-template").clone().attr("id","").addClass("active-tag-filter").insertBefore(".list");a(".active-tag-filter .inner .tag-filter-label").text(b);a(".listnote").each(function(){-1>=
a.inArray(b,a(this).data().tags)&&a(this).addClass("tag-hide")});a(".selected").removeClass("selected");a(".listnote:not(.search-hide,.tag-hide):first").addClass("selected");n();w("clear")},C=function(b){var d=a("html body").attr("class").split(" "),c,e;for(c=0,e=d.length;c<e;c+=1)"theme-"===d[c].substr(0,6)&&(d[c]="");a(".appearance .item.theme").siblings(".theme").addClass("dim");a("#"+b).removeClass("dim");a("html body").attr("class",d.join(" "));a("html body").addClass(b);localStorage.theme=b},
D=function(b){var d=a("html body").attr("class").split(" "),c,e;for(c=0,e=d.length;c<e;c+=1)"font-"===d[c].substr(0,5)&&(d[c]="");a(".appearance .font").siblings(".font").addClass("dim");a("#"+b).removeClass("dim");a("html body").attr("class",d.join(" "));a("html body").addClass(b);localStorage.font=b},E=function(b){var d=a("html body").attr("class").split(" "),c,e;for(c=0,e=d.length;c<e;c+=1)"fontsize-"===d[c].substr(0,9)&&(d[c]="");a(".appearance .fontsize").siblings(".fontsize").addClass("dim");
a("#"+b).removeClass("dim");a("html body").attr("class",d.join(" "));a("html body").addClass(b);localStorage.fontsize=b},F=function(b){var d=a("html body").attr("class").split(" "),c,e;for(c=0,e=d.length;c<e;c+=1)"sortby-"===d[c].substr(0,9)&&(d[c]="");a(".appearance .sortby").siblings(".sortby").addClass("dim");a("#"+b).removeClass("dim");a("html body").attr("class",d.join(" "));a("html body").addClass(b);localStorage.sortby=b;p()},Z=function(){var b,d,c;localStorage.theme?(b=localStorage.theme,
C(b)):C("theme-moleskine");a(".appearance .item.theme").click(function(){b=a(this).attr("id");a(this).removeClass("dim");C(b)});localStorage.font?(d=localStorage.font,D(d)):D("font-mono");a(".appearance .font").click(function(){d=a(this).attr("id");D(d)});localStorage.fontsize?(c=localStorage.fontsize,E(c)):E("fontsize-12");a(".appearance .fontsize").click(function(){var b=a(this).attr("id");E(b)});localStorage.sortby?(c=localStorage.sortby,F(c)):F("sortby-modified");a(".appearance .sortby").click(function(){var b=
a(this).attr("id");F(b)});"no-tags"===localStorage.tagPref&&(a("html body").addClass("no-tags"),a(".tag-pref").addClass("dim"));a(".appearance .tag-pref").click(function(){a(this).hasClass("dim")?(a(this).removeClass("dim"),a("html body").removeClass("no-tags"),localStorage.removeItem("tagPref")):(a(this).addClass("dim"),a("html body").addClass("no-tags"),localStorage.setItem("tagPref","no-tags"))});a(".note .textarea textarea").live("focus",function(){a(".current .note-directions").addClass("show");
a("div.current").addClass("highlight")});a(".note .textarea textarea").live("blur",function(){var b=a(this).parent().parent().parent().attr("id"),c=a("#list-"+b).data();-1<a.inArray("markdown",c.systemtags)&&r(b,"on");if(a(this).val()!==c.content)c=a.parseJSON(localStorage.getItem(b)),c.content=a(this).val(),c.modifydate=(new Date).getTime()/1E3,c.syncnum+=1,localStorage.setItem(b,JSON.stringify(c)),m(c.key),o();a(".current .note-directions").removeClass("show");a(".current").removeClass("highlight")});
a(".addnote").click(function(){M()});a(".tags").click(function(){A()});a(".reload").click(function(){o()});a(".close").click(function(){i()});a(".delete").live("click",function(){a(this).parent().children(".message").toggleClass("show").html('Mark this note as deleted?  <a href="#" class="confirmDelete">Delete</a> / <a href="#" class="cancelDelete">Cancel</a>')});a(".confirmDelete").live("click",function(){var b=a(this).parent().parent().attr("id"),c=a("#list-"+b).data();c.deleted=1;c.modifydate=
(new Date).getTime()/1E3;c.syncnum+=1;localStorage.setItem(c.key,JSON.stringify(c));a("#list-"+b).remove();a("#"+b).remove();a(".listnote:first").addClass(".selected");n();return!1});a(".cancelDelete").live("click",function(){a(".message").removeClass("show");return!1});a(".listnote").live("click",function(){var b=a(".selected"),c=a(".listnote:visible").index(b),d=a(".listnote:visible").index(this),b=Math.abs(d-c),c=c<d?"next":"prev";if(6>=b)if("next"===c)for(d=1;d<=b;d+=1)k();else{if("prev"===c)for(d=
1;d<=b;d+=1)j()}else"next"===c?(a(".selected").removeClass("selected"),a(".listnote:visible").eq(d-4).addClass("selected"),v(),k(),k(),k(),k()):"prev"===c&&(a(".selected").removeClass("selected"),a(".listnote:visible").eq(d+4).addClass("selected"),v(),j(),j(),j(),j())});a(".note").live("click",function(){a(".current").removeClass("current");a(this).addClass("current");a(".selected").removeClass("selected");a("#list-"+a(this).attr("id")).addClass("selected");v()});a(".textarea:not(a)").live("click",
function(b){0<a(b.target).parents(".tag-area").length||(r(a(this).parent().attr("id"),"off","temp"),a(this).children(".ta-inner").children("textarea").focus())});a(".markdown a").live("click",function(){a(this).attr("target","_blank")});a(".settings_icon").click(function(){a(".settings").toggleClass("show")});a(".userdata").click(function(){a(".settings").toggleClass("show");a(".settings_pane").removeClass("show");a(".settings_pane.data").addClass("show")});a(".settings .tabs a").click(function(b){a(".settings_pane").removeClass("show");
a(".settings_pane."+a(this).text().replace(" ","_")).addClass("show");b.preventDefault();return!1});a(".versions-button").live("mousedown",function(){var b=a(this).parent().attr("id");O(b)});a(".version-item").live("mousedown",function(){a(".diff-view").hasClass("depressed")?a(".versions-right .right-inner").html(a(this).data().diff):a(".versions-right .right-inner").html('<textarea disabled="disabled">'+a(this).data().content+"</textarea>");a(".version-select").removeClass("version-select");a(this).addClass("version-select")});
a(".versions-toolbar .diff-view,.versions-toolbar .text-view").live("mousedown",function(){a(".versions-toolbar .depressed").removeClass("depressed");a(this).addClass("depressed");1>a(".version-select").length&&a(".version-item:first").addClass(".version-select");a(this).hasClass("diff-view")?a(".versions-right .right-inner").html(a(".version-select").data().diff):a(this).hasClass("text-view")&&a(".versions-right .right-inner").html('<textarea disabled="disabled">'+a(".version-select").data().content+
"</textarea>")});a(".overlay").click(function(){i()});a(".versions-toolbar .revert-version").live("mousedown",function(){if(1===a(".version-select").length){var b=a(".version-select").attr("id").split("version").shift(),c=a(".version-select").data().content;a(".selected").removeClass("selected");a("#list-"+b).addClass("selected");a(".current").removeClass("current");a("#"+b).addClass("current");v();i();a(".note.current .textarea textarea").val(c).focus()}return!1});a(".clear-tag-filter").live("mouseup",
function(){Q()});a(".labels .item").live("mouseup",function(){B(a(this).attr("id"))});a(".tagit-label").live("mouseup",function(){B(a(this).text())});a(".markdown-button").live("mouseup",function(){r(a(this).parent().attr("id"))});a(".pin-button").live("mouseup",function(){L()});a(".cleardata").click(function(){localStorage.clear()});a(document).bind("keydown","esc",function(){i()});a(document).bind("keydown","j",function(){k()});a(document).bind("keydown","right",function(){k()});a(document).bind("keydown",
"down",function(){k()});a(document).bind("keydown","k",function(){j()});a(document).bind("keydown","left",function(){j()});a(document).bind("keydown","up",function(){j()});a(document).bind("keydown","return",function(){a(".current").hasClass("markdown-on")&&r(a(".current").attr("id"),"off","temp");a(".note.current .textarea textarea").focus();return!1});a(document).bind("keydown","tab",function(){a(".note.current .textarea textarea").focus();return!1});a(document).bind("keydown","shift+/",function(){a(".settings").toggleClass("show")});
a(document).bind("keydown","/",function(){a(".search input").select();return!1});a(document).bind("keydown","c",function(){M();return!1});a(document).bind("keydown","s",function(){o();return!1});a(document).bind("keydown","p",function(){L(a(".selected"))});a(document).bind("keydown","f",function(){u()});a(document).bind("keydown","l",function(){A();return!1});a(document).bind("keydown","t",function(){A();return!1});a(document).bind("keydown","v",function(){O(a(".current").attr("id"));return!1});a(document).bind("keydown",
"a",function(){N();return!1});a(document).bind("keydown","i",function(){N();return!1});a(document).bind("keydown","m",function(){r();return!1});a(".search input").keyup(a.debounce(250,z));a(".search input").bind("keydown","return",function(){a(this).blur();return!1});a(".search input").bind("keydown","esc",function(){a(this).val("");z();a(this).blur();return!1});a(".search input").bind("keydown","down",function(){a(this).blur();k();return!1});a(".search input").bind("keydown","up",function(){a(this).blur();
j();return!1});a(".labels input").keyup(function(a){a=a.which;38!==a&&40!==a&&13!==a&&P()});a(".labels input").bind("keydown","esc",function(){a(this).val("");a(this).blur();i();return!1});a(".labels input").bind("keydown","down",function(){var b=a(".label-select").nextAll(".item:not(.hide):first");0<b.length&&(a(".label-select").removeClass("label-select"),b.addClass("label-select"));return!1});a(".labels input").bind("keydown","up",function(){var b=a(".label-select").prevAll(".item:not(.hide):first");
0<b.length&&(a(".label-select").removeClass("label-select"),b.addClass("label-select"));return!1});a(".labels input").bind("keydown","return",function(){1===a(".label-select").length?B(a(".label-select .name").text()):a(".labels").effect("shake",{times:3},100,function(){a(".labels input").val("").select();P()});return!1});y(".note .textarea textarea")};a(function(){Z();if(localStorage.email){a(".username").text(localStorage.email);if(localStorage.index){var b,d,c;q(10);if(localStorage.index){c=a.parseJSON(localStorage.index);
for(b=0,d=c.data.length;b<d;b+=1)null!==localStorage.getItem(c.data[b].key)&&m(c.data[b].key)}0<a(".listnote").length&&(p(),n())}(new Date).getTime();o()}else window.location="/"})}();